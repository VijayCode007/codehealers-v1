<%- include ("./components/header.ejs") %>

       <style>
        #responseDiv {
            display: none;
        }
        #responseDiv2 {
            display: none;
        }
    </style>
    <form id="myForm">
        <label for="prompt">Prompt:</label>
        <input type="text" id="prompt" name="prompt" required>

        <button type="button" onclick="handleButtonClick()">Click me</button>
    </form>
    <div id="responseDiv"></div>
    <div id="responseDiv2"></div>

    <script>
        
        async function handleButtonClick() {
            let latitude, longitude;
            const getPosition = () => {
        return new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(
                position => resolve(position),
                error => reject(error)
            );
        });
    };

    try {
        if (navigator.geolocation) {
            const position = await getPosition();
            latitude = position.coords.latitude;
            longitude = position.coords.longitude;
            console.log(latitude, longitude);
            // Continue with the rest of your code using latitude and longitude
        } else {
            console.error('Geolocation not supported by the browser');
        }
    } catch (error) {
        console.error('Error getting user location:', error);
    }

            const prompt = document.getElementById('prompt').value;
            const myString = `
            Patient Details:
            - Age: <%= user.age %>
            - Gender: <%= user.gender %>
            - Height: <%= user.height %>cm
            - Weight: <%= user.weight %>KG
            - Blood Group: <%= user.bg %>
            - Chronic Disease: <%= user.sp %>
            Current Symptoms:
            ${prompt}

            Generate Health Information:
            Organize the information in a list format for easy extraction.Dont remove '::::' from the response
            1. **Health Situation:**
            - Suggest the potential disease name and details based on the presented symptoms. Specify a specific disease.
            ::::
            2. **Immediate Actions:**
            - Suggest immediate actions the patient should take for symptom relief.
            ::::
            3. **Potential Causes:**
            - Identify potential causes related to the presented symptoms.
            ::::
            4. **Consult a Healthcare Professional:**
            - Advise on the urgency of seeking medical attention and potential diagnostic steps.
            - Include recommendations for specific medical tests or diagnoses.
            ::::
            5. **Long-Term Prevention:**
            - Recommend long-term preventive measures, including vaccinations, lifestyle changes, and hygiene practices.
            ::::
            6. **Possible Medications (emergency situation - consult a doctor if possible, otherwise consider the following):**
            - Suggest possible over-the-counter medications for symptom management. Emphasize the urgency and the emergency nature of the situation.The patient couldn't contact the doctor and it's a emergency so please suggest whatever medication you could from the information available on the internet
            ::::
            7. **Severity Rating:**
            - Provide a severity rating on a scale of 1 to 10 for the presented symptoms. 
            `;
            var main_data = ''
 
            document.getElementById('myForm').style.display = 'none';
            fetch('/buddy', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: myString,
                    lat: latitude,
                    long: longitude
                }),
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('responseDiv').innerText = data.op;
                    document.getElementById('responseDiv2').innerText = data.ge;
                    main_data = data.op.split("::::")
                    console.log(main_data);
                    document.getElementById('responseDiv').style.display = 'block';
                    document.getElementById('responseDiv2').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error sending POST request:', error);
                });
        }
    </script>
<%- include ("./components/footer.ejs") %>

